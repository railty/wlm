<p id="notice"><%= notice %></p>

<h1>Listing Jobs</h1>

<table class='table table-striped table-condensed'>
  <thead>
    <tr>
      <th>Job</th>
      <th>State</th>
      <th>Input</th>
      <th>Output</th>
      <th>Time</th>
      <th>Delete</th>
    </tr>
  </thead>

  <tbody>
    <% @jobs.each do |job| %>
      <tr>
        <td><%= job.name %></td>
        <td><%= job.state %></td>
        <td><%= link_to job.input, download_job_path(job, file: 'input', format: "xlsx") %></td>
        <td><%= link_to job.output, download_job_path(job, file: 'output', format: "xlsx") %></td>
        <td><%= job.finish==nil ? 0 : (job.finish-job.start).to_i.to_s + ' seconds' %></td>
        <td><%= link_to 'Destroy', job, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<hr/>

<%if user_signed_in? and current_user.role == 'admin' then %>
  <h3>Upload daily report</h3>
  <%= form_tag({action: :upload_items}, multipart: true) do %>
    <%= file_field_tag 'excel' %>
    <%= submit_tag("upload") %>
  <% end %>

  <hr/>
  <h3>Upload Price Guide</h3>
  <%= form_tag({action: :price_guide}, multipart: true) do %>
    <%= file_field_tag 'excel' %>
    <%= submit_tag("upload") %>
  <% end %>

  <hr/>
  <h3>Download Store Products</h3>
  <%=link_to 'Download', download_stores_products_jobs_path, :class=>"btn btn-primary", :role=>"button"%>
  <hr/>
  <%=link_to 'Delete WmItems', delete_wm_items_jobs_path, :class=>"btn btn-danger", :role=>"button"%>
<% end %>
